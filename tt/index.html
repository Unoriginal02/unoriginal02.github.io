<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Task Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        :root {
            --main-color: #eeeeee;
            --main-color-hover: rgba(238, 238, 238, .1);
            --button-active-color: #ff4d4d; /* Red color for active button */
        }

        html,
        body {
            margin: 0;
        }

        body {
            background-color: #000000;
            color: var(--main-color);
            font-family: 'JetBrains Mono', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
        }

        h2 {
            text-align: center;
        }

        .maxwidth {
            max-width: 800px;
            margin: auto;
            display: flex;
            flex-direction: column;
        }

        .task-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
        }

        .task-row input[type="text"] {
            flex-grow: 1;
            background-color: #000000;
            color: var(--main-color);
            border: 1px solid var(--main-color);
            margin-right: 10px;
        }

        .task-row button {
            border: 1px solid var(--main-color);
            background-color: #000000;
            color: var(--main-color);
            padding: 5px 10px;
            border-radius: 0;
            margin-right: 5px;
        }

        .task-row .timer {
            min-width: 80px;
            text-align: center;
        }

        .task-row .adjust-buttons {
            display: flex;
            align-items: center;
        }

        .task-row .adjust-buttons button {
            margin-right: 5px;
            font-size: 1.5rem;
        }

        .task-row .decimal-time {
            font-size: 1.5rem;
            margin-left: auto;
        }

        .hidden {
            display: none !important;
        }

        .button-active {
            background-color: var(--button-active-color) !important;
            border-color: var(--button-active-color) !important;
            color: black !important;
        }

        .StartStop{
            width: 96px;
        }
    </style>
</head>

<body>

    <div class="maxwidth container text-center my-5">
        <h2>Task Tracker</h2>
        <div id="tasks"></div>
        <button id="addTaskButton" class="brutalButton mt-3">Add New Task</button>
        <button id="toggleTotalsButton" class="brutalButton mt-3">Show Totals</button>
        <div id="totalsSum" class="mt-3 hidden"></div>
    </div>

    <script>
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let showTotals = false;

        function updateLocalStorage() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const mins = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            return `${hrs}:${mins}:${secs}`;
        }

        function roundToQuarterHour(minutes) {
            return Math.round(minutes / 15) * 0.25;
        }

        function createTaskRow(task, index) {
            const taskRow = document.createElement('div');
            taskRow.className = 'task-row';

            const taskInput = document.createElement('input');
            taskInput.type = 'text';
            taskInput.value = task.name;
            taskInput.placeholder = 'Enter task name';
            taskInput.addEventListener('input', () => {
                tasks[index].name = taskInput.value;
                updateLocalStorage();
            });

            const timerDisplay = document.createElement('div');
            timerDisplay.className = 'timer';
            timerDisplay.textContent = formatTime(task.time);
            timerDisplay.id = `timer-${index}`;

            const startStopButton = document.createElement('button');
            startStopButton.textContent = task.isRunning ? 'Stop' : 'Start';
            startStopButton.classList.add('StartStop');
            startStopButton.classList.toggle('button-active', task.isRunning); // Make red when running
            startStopButton.addEventListener('click', () => {
                tasks.forEach((t, i) => {
                    if (i !== index) {
                        t.isRunning = false;
                    }
                });

                task.isRunning = !task.isRunning;
                if (task.isRunning) {
                    task.startTime = Date.now() - task.time * 1000;
                }
                updateLocalStorage();
                renderTasks();
            });

            // Trash Icon for Delete Button using Font Awesome
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>'; // Trash icon
            deleteButton.addEventListener('click', () => {
                tasks.splice(index, 1);
                updateLocalStorage();
                renderTasks();
            });

            taskRow.appendChild(taskInput);
            taskRow.appendChild(timerDisplay);
            taskRow.appendChild(startStopButton);
            taskRow.appendChild(deleteButton);

            // Add adjust buttons and decimal time, initially hidden
            const adjustButtons = document.createElement('div');
            adjustButtons.className = `adjust-buttons ${showTotals ? '' : 'hidden'}`;
            adjustButtons.id = `adjust-buttons-${index}`;

            const minusButton = document.createElement('button');
            minusButton.textContent = '-';
            minusButton.addEventListener('click', () => {
                task.time = Math.max(0, task.time - 900); // Subtract 15 minutes
                updateLocalStorage();
                renderTasks();
            });

            const plusButton = document.createElement('button');
            plusButton.textContent = '+';
            plusButton.addEventListener('click', () => {
                task.time += 900; // Add 15 minutes
                updateLocalStorage();
                renderTasks();
            });

            const decimalTime = document.createElement('div');
            decimalTime.className = `decimal-time ${showTotals ? '' : 'hidden'}`;
            decimalTime.id = `decimal-time-${index}`;
            const decimalValue = roundToQuarterHour(task.time / 60);
            decimalTime.textContent = decimalValue.toFixed(2);

            adjustButtons.appendChild(minusButton);
            adjustButtons.appendChild(plusButton);
            taskRow.appendChild(adjustButtons);
            taskRow.appendChild(decimalTime);

            return taskRow;
        }

        function renderTasks() {
            const tasksContainer = document.getElementById('tasks');
            tasksContainer.innerHTML = '';
            tasks.forEach((task, index) => {
                tasksContainer.appendChild(createTaskRow(task, index));
            });
            if (showTotals) {
                calculateTotalSum();
            } else {
                document.getElementById('totalsSum').classList.add('hidden');
            }
        }

        function calculateTotalSum() {
            let totalSum = tasks.reduce((sum, task) => sum + roundToQuarterHour(task.time / 60), 0);
            document.getElementById('totalsSum').textContent = `Total: ${totalSum.toFixed(2)} hours`;
            document.getElementById('totalsSum').classList.remove('hidden');
        }

        function updateTimers() {
            tasks.forEach((task, index) => {
                if (task.isRunning) {
                    task.time = Math.floor((Date.now() - task.startTime) / 1000);
                    document.getElementById(`timer-${index}`).textContent = formatTime(task.time);
                }
            });
            updateLocalStorage();
        }

        document.getElementById('addTaskButton').addEventListener('click', () => {
            tasks.push({ name: '', time: 0, isRunning: false, startTime: null });
            updateLocalStorage();
            renderTasks();
        });

        document.getElementById('toggleTotalsButton').addEventListener('click', () => {
            showTotals = !showTotals;
            if (showTotals) {
                document.getElementById('toggleTotalsButton').textContent = 'Hide Totals';
            } else {
                document.getElementById('toggleTotalsButton').textContent = 'Show Totals';
                document.getElementById('totalsSum').classList.add('hidden');
            }
            renderTasks();
        });

        renderTasks();
        setInterval(updateTimers, 1000);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
</body>

</html>
